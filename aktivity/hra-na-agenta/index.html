<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hra na agenta - Gener√°tor protokolov</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(to right, #2563eb, #1d4ed8);
            color: white;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .language-selector {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .language-selector button {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            border: 2px solid transparent;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 6px;
        }

        .language-selector button:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: none;
            box-shadow: none;
        }

        .language-selector button.active {
            background: white;
            color: #2563eb;
            border-color: white;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: white;
            padding: 0.5rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            color: #334155;
            transition: all 0.2s;
        }

        .tab:hover {
            background: #f1f5f9;
        }

        .tab.active {
            background: #2563eb;
            color: white;
        }

        .subtabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: #f8fafc;
            padding: 0.5rem;
            border-radius: 6px;
        }

        .subtab {
            flex: 1;
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            color: #475569;
            transition: all 0.2s;
        }

        .subtab:hover {
            background: white;
        }

        .subtab.active {
            background: white;
            color: #2563eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .subtab-content {
            display: none;
        }

        .subtab-content.active {
            display: block;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .card h2 {
            color: #2563eb;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e2e8f0;
            font-size: 1.75rem;
        }

        .card h3 {
            color: #2563eb;
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }

        .form-group {
            margin-bottom: 2rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #1e293b;
            font-size: 0.95rem;
        }

        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            max-width: 500px;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: inherit;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        input::placeholder,
        textarea::placeholder {
            color: #94a3b8;
            opacity: 1;
        }

        textarea {
            min-height: 90px;
            resize: vertical;
            max-width: 600px;
        }

        small {
            display: block;
            margin-top: 0.5rem;
            color: #64748b;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        button {
            background: #2563eb;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            background: #1d4ed8;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: #64748b;
        }

        button.secondary:hover {
            background: #475569;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .protocol-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
        }

        .protocol-table th,
        .protocol-table td {
            border: 2px solid black;
            padding: 0.75rem;
            text-align: center;
        }

        .protocol-table th {
            background: white;
            font-weight: bold;
        }

        .protocol-table .encrypted {
            color: #dc2626;
            font-family: monospace;
        }

        .protocol-table .control {
            font-weight: bold;
            font-family: monospace;
        }

        .phonetic-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .phonetic-item {
            display: flex;
            gap: 0.5rem;
        }

        .phonetic-item strong {
            min-width: 1.5rem;
        }

        .cipher-wheel-container {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .protocol-box {
            border: 2px solid black;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .protocol-fields {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .protocol-field {
            border: 2px solid black;
            height: 40px;
            border-radius: 4px;
        }

        .protocol-header {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .protocol-header-box {
            border: 2px solid black;
            padding: 1rem;
            border-radius: 4px;
        }

        .protocol-header-box label {
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .protocol-header-line {
            border-bottom: 2px solid black;
            height: 30px;
            margin-top: 0.25rem;
        }

        .info-box {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid #e2e8f0;
        }

        .number-control {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .number-control input {
            width: 80px;
            text-align: center;
            max-width: 80px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .number-control button {
            padding: 0;
            width: 44px;
            height: 44px;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        /* Print styles */
        @media print {
            body {
                background: white;
                margin: 0;
                padding: 0;
            }

            .no-print {
                display: none !important;
            }

            .subtabs {
                display: none !important;
            }

            .header {
                display: none;
            }

            .container {
                max-width: 100%;
                margin: 0;
                padding: 0;
            }

            .card {
                box-shadow: none;
                border: none;
                page-break-inside: avoid;
                padding: 0.5rem !important;
                margin: 0 !important;
            }

            .page-break {
                page-break-after: always;
            }

            @page {
                margin: 6mm;
                size: A4 portrait;
            }

            /* Station protocol specific */
            .protocol-header {
                gap: 0.5rem !important;
                margin-bottom: 0.5rem !important;
            }

            .protocol-header-box {
                padding: 0.4rem !important;
                min-height: 40px !important;
            }

            .protocol-header-box label {
                font-size: 0.75rem !important;
                margin-bottom: 0.25rem !important;
            }

            .protocol-header-line {
                height: 20px !important;
            }

            .protocol-box {
                padding: 0.5rem !important;
                margin-bottom: 0.5rem !important;
            }

            .protocol-fields {
                gap: 0.3rem !important;
                margin-top: 0.3rem !important;
            }

            .protocol-field {
                height: 30px !important;
            }

            .info-box {
                padding: 0.5rem !important;
                margin: 0.5rem 0 !important;
                font-size: 0.8rem !important;
            }

            .grid-2 {
                gap: 0.5rem !important;
                margin-top: 0.5rem !important;
            }

            .phonetic-grid {
                gap: 0.2rem !important;
                font-size: 0.7rem !important;
            }

            .cipher-wheel-container svg {
                max-width: 280px !important;
            }

            #tab-station .grid-2 > div {
                padding: 0.5rem !important;
            }

            #tab-station .grid-2 > div > div:first-child {
                font-size: 0.8rem !important;
                margin-bottom: 0.5rem !important;
            }

            /* Control protocol specific */
            .protocol-table {
                font-size: 0.9rem;
            }

            .protocol-table th,
            .protocol-table td {
                padding: 0.5rem;
            }

            /* Inner wheels specific */
            #inner-wheels .card {
                padding: 0 !important;
                margin: 0 !important;
            }
        }

        @media print and (orientation: landscape) {
            @page {
                size: A4 landscape;
                margin: 10mm;
            }
        }
    </style>
</head>
<body>
    <div class="header no-print">
        <div class="language-selector">
            <button onclick="switchLanguage('sk')" class="active" id="lang-sk">SK</button>
            <button onclick="switchLanguage('en')" id="lang-en">EN</button>
            <button onclick="switchLanguage('pt_BR')" id="lang-pt">PT</button>
        </div>
        <h1>
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            <span data-i18n="title">Hra na agenta</span>
        </h1>
        <p data-i18n="subtitle">Gener√°tor protokolov pre skautsk√© dru≈æstv√°</p>
    </div>

    <div class="container">
        <div class="tabs no-print">
            <button class="tab active" onclick="switchTab('instructions', this)" data-i18n="tabInstructions">In≈°trukcie</button>
            <button class="tab" onclick="switchTab('station', this)" data-i18n="tabStation">Protokol stanice</button>
            <button class="tab" onclick="switchTab('control', this)" data-i18n="tabControl">Protokol riadiacej stanice</button>
        </div>

        <!-- Instructions Tab -->
        <div id="tab-instructions" class="tab-content active">
            <div class="card">
                <h2 data-i18n="gameTitle">Hra na agenta</h2>
                <p data-i18n="gameIntro">Hra na agenta je hr√° pre 1-2 ƒçlenn√© dru≈æstv√° det√≠ (skautov), tieto dru≈æstva s√∫ nazvan√© <strong>STANICE</strong>, alebo "agenti" (volacie znaky: JOTA1, JOTA2...). <strong>STANICE</strong> prij√≠maj√∫ povely od <strong>RIADIACEJ STANICE</strong> (volac√≠ znak JOTA), a na z√°klade jej povelov jej nasp√§≈• komunikuj√∫ svoje zistenia. Na konci hry ka≈æd√° STANICA odovzd√° <strong>RIADIACEJ STANICI PROTOKOL</strong> s v√Ωsledkami svojich zisten√≠.<strong>RIADIACA STANICA</strong> vyhodnoti protokoly v≈°etk√Ωch stan√≠c a ozn√°mi v√Ωsledok hry. Jednotliv√© stanice "agenti" tak maj√∫ spolu zlo≈æi≈• "k√≥dovanu spr√°vu", ktor√° zachr√°ni svet a jej znenie sa dozvedia na konci hry.</p>
            </div>

            <div class="card">
                <h3 data-i18n="goalTitle">Cieƒæ hry</h3>
                <p data-i18n="goalText1">Cieƒæom celej hry je precviƒçi≈• u det√≠/skautov slovensk√∫ (pr√≠padne medzin√°rodn√∫) hl√°skovaciu abecedu pou≈æ√≠van√∫ v r√°dioamat√©rskom svete a nauƒçi≈• ich komunik√°cii podƒæa v≈°eobecnej sch√©my pre fonick√© r√°dioamat√©rske spojenia.</p>
                <p data-i18n="goalText2">Jednotliv√© stanice "agenti" tak maj√∫ spolu zlo≈æi≈• "k√≥dovan√∫ spr√°vu", ktor√° zachr√°ni svet a jej znenie sa dozvedia na konci hry.</p>
            </div>

            <div class="card">
                <h3 data-i18n="gameflowTitle">Priebeh hry</h3>

                <h4 style="margin-top: 1.5rem;" data-i18n="step1">1. Pr√≠prava</h4>
                <p data-i18n="step1Text">Na zaƒçiatku hry skauti vytvoria 1-2 ƒçlenn√© dru≈æstv√°. Ka≈æd√© dru≈æstvo dostane PMR446 vysielaƒçku. V≈°etky vysielaƒçky s√∫ nastaven√© na rovnak√Ω kan√°l. RIADIACA STANICE (volac√≠ znak JOTA) odovzd√° ka≈æd√©mu dru≈æstvu tvrd√∫ papierov√∫ dosku s perom a PROTOKOLOM STANICE a ozn√°mi v≈°etk√Ωm dru≈æstv√°m ≈°ifrovac√≠ kƒæ√∫ƒç - dve p√≠smen√°, pomocou ktor√©ho bud√∫ ƒèalej de≈°ifrova≈• slov√° podƒæa pokynov na protokole.</p>

                <h4 style="margin-top: 2rem;" data-i18n="step2">2. Rozmiestnenie</h4>
                <p data-i18n="step2Text">Jednotliv√© dru≈æstv√° sa roz√≠du do priestoru (napr√≠klad na l√∫ke), tak aby sa navz√°jom nepoƒçuli.</p>

                <h4 style="margin-top: 2rem;" data-i18n="step3">3. Kontrola spojenia</h4>
                <p data-i18n="step3Text">Riadiaca stanica sprav√≠ kontrolu spojenia s jednotliv√Ωmi stanicami (x je poradov√© ƒç√≠slo stanice) podƒæa nasleduj√∫cej sch√©my:</p>
                <div style="background: #f8fafc; padding: 1rem; border-left: 4px solid #2563eb; margin: 1rem 0; font-family: monospace; font-size: 0.9rem;">
                    <p style="margin: 0.25rem 0;" data-i18n="tx3_1">JOTAx vol√° ≈•a JOTA</p>
                    <p style="margin: 0.25rem 0;" data-i18n="tx3_2">JOTA tu JOTAx Na pr√≠jme</p>
                    <p style="margin: 0.25rem 0;" data-i18n="tx3_3">JOTAx JOTA ƒéakujem</p>
                </div>

                <h4 style="margin-top: 2rem;" data-i18n="step4">4. Odovzd√°vanie slov</h4>
                <p data-i18n="step4Text">Riadiaca stanica postupne nadv√§zuje spojenia s jednotliv√Ωmi stanicami a odovzd√°va im slov√°, medzi jednotliv√Ωmi slovami poƒçk√° chv√≠ƒæu:</p>
                <div style="background: #f8fafc; padding: 1rem; border-left: 4px solid #2563eb; margin: 1rem 0; font-family: monospace; font-size: 0.9rem;">
                    <p style="margin: 0.25rem 0;" data-i18n="tx4_1">JOTAx vol√° ≈•a JOTA</p>
                    <p style="margin: 0.25rem 0;" data-i18n="tx4_2">JOTA JOTAx Poƒç√∫vam</p>
                    <p style="margin: 0.25rem 0;" data-i18n="tx4_3">JOTAx JOTA Prv√© slovo: Tom√°≈° Xaver Bo≈æena Peter Adam, opakujem: Tom√°≈° Xaver Bo≈æena Peter Adam. M√°≈° zap√≠san√©?</p>
                    <p style="margin: 0.25rem 0;" data-i18n="tx4_4">JOTA JOTAx √Åno, m√°m v≈°etko zap√≠san√©, m√¥≈æe≈° pokraƒçova≈• druh√Ωm slovom</p>
                    <p style="margin: 0.25rem 0;" data-i18n="tx4_5">JOTAx JOTA Druh√© slovo: Jozef Adam Norbert Karol Oto, opakujem: Jozef Adam Norbert Karol Oto. M√°≈° zap√≠san√©?</p>
                    <p style="margin: 0.25rem 0;" data-i18n="tx4_6">JOTA JOTAx V≈°etko prijat√©, m√¥≈æe≈° pokraƒçova≈• na ƒèal≈°iu stanicu.</p>
                </div>
                <p data-i18n="step4Text2">Stanica JOTAx posklad√° na z√°klade hl√°skovacej abecedy z vyhl√°skovan√Ωch p√≠smen slovo 1 a slovo 2 a zap√≠≈°e ho do protokolu. Potom zaƒçne spracov√°va≈• slov√° podƒæa pokynov v protokole - de≈°ifruje slovo 2 podƒæa kƒæ√∫ƒça. Riadiaca stanica pokraƒçuje spojen√≠m s ƒèal≈°ou JOTAx stanicou.</p>

                <h4 style="margin-top: 2rem;" data-i18n="step5">5. Kontrola pripravenosti</h4>
                <p data-i18n="step5Text">Riadiaca stanica nech√° v≈°etk√Ωm staniciam ƒças na spracovanie √∫lohy (cca 10 min√∫t od komunik√°cie s poslednou stanicou) a n√°sledne zavol√° v≈°eobecn√∫ v√Ωzvu, na ktor√∫ bud√∫ stanice JOTAx odpoveda≈• statusom o pripravenosti:</p>
                <div style="background: #f8fafc; padding: 1rem; border-left: 4px solid #2563eb; margin: 1rem 0; font-family: monospace; font-size: 0.9rem;">
                    <p style="margin: 0.25rem 0;" data-i18n="tx5_1">V√Ωzva pre v≈°etky stanice, tu JOTA: JOTA1 a≈æ JOTAn, ozn√°mte svoju pripravenos≈• odpoveda≈• na √∫lohy!</p>
                </div>
                <p data-i18n="step5Text2">Jednotliv√© stanice odpovedaj√∫:</p>
                <div style="background: #f8fafc; padding: 1rem; border-left: 4px solid #2563eb; margin: 1rem 0; font-family: monospace; font-size: 0.9rem;">
                    <p style="margin: 0.25rem 0;" data-i18n="tx5_2">JOTA JOTAx: Pripraven√° / Potrebujeme e≈°te ƒças</p>
                </div>
                <p data-i18n="step5Text3">V pr√≠pade, ≈æe niektor√© stanice nebud√∫ e≈°te pripraven√©, riadiaca stanica im nech√° ƒças a nesk√¥r zopakuje v√Ωzvu znova. Keƒè s√∫ v≈°etky JOTAx stanice pripraven√©, zaƒçne f√°za odovzd√°vania rie≈°en√≠ √∫loh.</p>

                <h4 style="margin-top: 2rem;" data-i18n="step6">6. Odovzd√°vanie rie≈°en√≠</h4>
                <p data-i18n="step6Text">Riadiaca stanica postupne vol√° v≈°etky stanice a ≈æiada o vyhl√°skovanie de≈°ifrovan√©ho 1. slova. V√Ωsledok skontroluje podƒæa protokolu riadiacej stanice, v riadku KONTROLA a oznaƒç√≠ zakr√∫≈ækovan√≠m stanicu ak spr√°vne de≈°ifrovala slovo 2.</p>
                <div style="background: #f8fafc; padding: 1rem; border-left: 4px solid #2563eb; margin: 1rem 0; font-family: monospace; font-size: 0.9rem;">
                    <p style="margin: 0.25rem 0;" data-i18n="tx6_1">JOTAx vol√° ≈•a JOTA Vyhlaskuj de≈°ifrovan√© 1. slovo</p>
                    <p style="margin: 0.25rem 0;" data-i18n="tx6_2">JOTA JOTAx Slovo je: Cyril Adam Rudolf Norbert Ivan</p>
                    <p style="margin: 0.25rem 0;" data-i18n="tx6_3">JOTAx JOTA ƒéakujem, Sedem Tri.</p>
                </div>
            </div>

            <div class="card">
                <h3 data-i18n="endingTitle">Ukonƒçenie hry</h3>
                <p data-i18n="endingText1">Po odovzdan√≠ v≈°etk√Ωch dek√≥dovan√Ωch slov stanicami sa v≈°etky dru≈æstv√° z√≠du pri Riadiacej stanici, ktor√° vyhodnot√≠ protokoly jednotliv√Ωch stan√≠c a prejd√∫ si spolu jednotliv√© problemov√© momenty, s ktor√Ωmi stanice mohli ma≈• ≈•a≈ækosti.</p>
                <p data-i18n="endingText2">Nakoniec Riadiaca stanica ozn√°mi v≈°etk√Ωm staniciam spoloƒçne de≈°ifrovan√∫ spr√°vu, ktor√° pomohla zachr√°ni≈• svet a rozd√° dru≈æstv√°m pr√≠padne odmeny.</p>
            </div>

            <div class="card" style="background: #fef3c7; border: 1px solid #fbbf24;">
                <h3 data-i18n="examplesTitle">Pr√≠klady spr√°v</h3>
                <div style="font-family: monospace; margin-top: 1rem;">
                    <p style="margin-top: 0.5rem;">1. CARNI BOCAN NOZKI ZMOCI HLAVU VNORI ZABKU CHICI DOBRE CHUTI</p>
                    <p style="margin-top: 0.5rem;">2. DZIVA LABUT PLAVA ZOBAK VNARA RYBKU CHYTA</p>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3 data-i18n="protocolStationTitle">Protokol stanice</h3>
                    <p data-i18n="protocolStationText">Protokol stanice je form√°tu A4. V dolnej pravej ƒçasti je fixn√Ω kruh s mal√Ωmi p√≠smenkami anglickej abecedy vo vonkaj≈°√≠ch poliach. S√∫ƒças≈•ou protokolu je aj extern√Ω rotovac√≠ kƒæ√∫ƒçovac√≠ kr√∫≈æok, ktor√Ω sa vlo≈æ√≠ do vn√∫torn√©ho poƒæa fixn√©ho kruhu a nastav√≠ sa podƒæa zdelen√©ho kƒæ√∫ƒça. P√≠smen√° v tomto rotovateƒænom kruhu s√∫ veƒæk√©. Oba kruhy predstavuj√∫ ≈°ifrovanie Albertiho ≈°ifrou.</p>
                </div>
                <div class="card">
                    <h3 data-i18n="protocolControlTitle">Protokol riadiacej stanice</h3>
                    <p data-i18n="protocolControlText">Protokol riadiacej stanice je tabuƒæka s p√°rom slov pre ka≈æd√∫ stanicu a v kontrolnom riadku je de≈°ifrovan√© 1. slovo na z√°klade kƒæ√∫ƒça Albertiho ≈°ifry. Tento protokol pou≈æ√≠va riadiaca stanica na pr√≠pravu hry a kontrolu v√Ωsledkov.</p>
                </div>
            </div>
        </div>

        <!-- Station Protocol Tab -->
        <div id="tab-station" class="tab-content">
            <div class="subtabs no-print">
                <button class="subtab active" onclick="switchSubtab('protocol', this)" data-i18n="subtabProtocol">Protokol Stanice</button>
                <button class="subtab" onclick="switchSubtab('circles', this)" data-i18n="subtabCircles">Vn√∫torn√© Kot√∫ƒçe</button>
            </div>

            <!-- Protocol Subtab -->
            <div id="subtab-protocol" class="subtab-content active">
                <div class="card no-print">
                    <h2 data-i18n="stationProtocolGenTitle">Gener√°tor Protokolu Stanice</h2>
                    <p style="margin-bottom: 1.5rem; color: #64748b;" data-i18n="stationProtocolNote">N√°zov stanice a ≈°ifrovac√≠ kƒæ√∫ƒç sa vyp√≠≈°u ruƒçne na vytlaƒçen√Ω protokol poƒças hry.</p>
                    <div class="form-group">
                        <label data-i18n="copiesLabel">Poƒçet k√≥pi√≠ protokolu</label>
                        <div class="number-control">
                            <button onclick="changeProtocolCopies(-1)">-</button>
                            <input type="number" id="protocolCopies" value="1" min="1" max="50" onchange="updateProtocolCopies()">
                            <button onclick="changeProtocolCopies(1)">+</button>
                        </div>
                    </div>
                    <button onclick="printProtocol()" data-i18n="printButton">üñ®Ô∏è Tlaƒçi≈• protokol</button>
                </div>

                <div id="station-protocols"></div>
            </div>

            <!-- Circles Subtab -->
            <div id="subtab-circles" class="subtab-content">
                <div class="card no-print">
                    <h2 data-i18n="innerCirclesGenTitle">Gener√°tor Vn√∫torn√Ωch Kot√∫ƒçov</h2>
                    <p style="margin-bottom: 1.5rem; color: #64748b;" data-i18n="innerCirclesNote">Vn√∫torn√© kot√∫ƒçe sa vytlaƒçia, vystrihn√∫ a vlo≈æia do protokolu stanice pre de≈°ifrovanie.</p>

                    <div class="form-group">
                        <label data-i18n="wheelSizeLabel">Veƒækos≈• kot√∫ƒça (px)</label>
                        <div class="number-control">
                            <button onclick="changeWheelSize(-10)">-</button>
                            <input type="number" id="wheelSize" value="350" min="100" max="400" step="10" onchange="updateWheelSize()">
                            <button onclick="changeWheelSize(10)">+</button>
                        </div>
                        <small id="wheelsPerPage"></small>
                    </div>

                    <div class="form-group">
                        <label data-i18n="innerCirclesLabel">Poƒçet vn√∫torn√Ωch kot√∫ƒçov</label>
                        <div class="number-control">
                            <button onclick="changeCircleCount(-1)">-</button>
                            <input type="number" id="circleCount" value="6" min="1" max="100" onchange="updateCircleCount()">
                            <button onclick="changeCircleCount(1)">+</button>
                        </div>
                        <small id="totalPages"></small>
                    </div>

                    <button onclick="printCircles()" data-i18n="printCirclesButton">üñ®Ô∏è Tlaƒçi≈• kot√∫ƒçe</button>
                </div>

                <div id="inner-wheels"></div>
            </div>
        </div>

        <!-- Control Protocol Tab -->
        <div id="tab-control" class="tab-content">
            <div class="card no-print">
                <h2 data-i18n="controlProtocolGenTitle">Gener√°tor Protokolu Riadiacej Stanice</h2>

                <div class="form-group">
                    <label data-i18n="numStationsLabel">Poƒçet stan√≠c</label>
                    <div class="number-control">
                        <button onclick="changeNumStations(-1)">-</button>
                        <input type="number" id="numStations" value="5" min="1" max="20" onchange="updateNumStations()">
                        <button onclick="changeNumStations(1)">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="controlKey" data-i18n="encryptionKeyLabel">≈†ifrovac√≠ kƒæ√∫ƒç (2 p√≠smen√°)</label>
                    <input type="text" id="controlKey" data-i18n-placeholder="encryptionKeyPlaceholder" placeholder="Napr√≠klad: xA" maxlength="2">
                    <small data-i18n="encryptionKeyHelp">Prv√© p√≠smeno z vonkaj≈°ieho kruhu (mal√©), druh√© z vn√∫torn√©ho (veƒæk√©).</small>
                </div>

                <div class="form-group">
                    <label for="resultPhrase" data-i18n="resultPhraseLabel">V√Ωsledn√° fr√°za (slov√° oddelen√© medzerou)</label>
                    <textarea id="resultPhrase" data-i18n-placeholder="resultPhrasePlaceholder" placeholder="Napr√≠klad: ƒå√ÅRNI BOƒåAN NO≈ΩKI ZMOƒå√ç HLAVU" style="text-transform: uppercase;"></textarea>
                    <small data-i18n="resultPhraseHelp">Toto s√∫ slov√°, ktor√© stanice de≈°ifruj√∫. Vytvorte zmyslupln√∫ fr√°zu.</small>
                </div>

                <div class="form-group">
                    <label for="controlWords" data-i18n="controlWordsLabel">Kontroln√© slov√° pre 2. riadok (voliteƒæn√©)</label>
                    <textarea id="controlWords" data-i18n-placeholder="controlWordsPlaceholder" placeholder="Napr√≠klad: ADAM BORIS CYRIL (nechajte pr√°zdne pre n√°hodn√© generovanie)" style="text-transform: uppercase;"></textarea>
                    <small data-i18n="controlWordsHelp">Slov√° sa n√°hodne vygeneruj√∫, ak niƒç nezad√°te.</small>
                </div>

                <div class="button-group">
                    <button onclick="generateControlProtocol()" data-i18n="generateButton">‚ú® Generova≈• protokol</button>
                    <button class="secondary" onclick="window.print()" id="printControlBtn" style="display: none;" data-i18n="printButton">üñ®Ô∏è Tlaƒçi≈•</button>
                </div>
            </div>

            <div id="control-protocol-output"></div>
        </div>
    </div>

    <script>
        // Constants
        const PHONETIC_ALPHABETS = {
            sk: [
                ['A', 'Adam'], ['B', 'Bo≈æena'], ['C', 'Cyril'], ['D', 'D√°vid'],
                ['E', 'Emil'], ['F', 'Franti≈°ek'], ['G', 'Gust√°v'], ['H', 'Helena'],
                ['I', 'Ivan'], ['J', 'Jozef'], ['K', 'Karol'], ['L', 'Ladislav'],
                ['M', 'M√°ria'], ['N', 'Norbert'], ['O', 'Oto'], ['P', 'Peter'],
                ['Q', 'Qu√≠do'], ['R', 'Rudolf'], ['S', 'Sv√§topluk'], ['T', 'Tom√°≈°'],
                ['U', 'Urban'], ['V', 'V√°clav'], ['W', 'Dvojit√© W'], ['X', 'Xaver'],
                ['Y', 'Ypsilon'], ['Z', 'Zuzana']
            ],
            en: [
                ['A', 'Alfa'], ['B', 'Bravo'], ['C', 'Charlie'], ['D', 'Delta'],
                ['E', 'Echo'], ['F', 'Foxtrot'], ['G', 'Golf'], ['H', 'Hotel'],
                ['I', 'India'], ['J', 'Juliet'], ['K', 'Kilo'], ['L', 'Lima'],
                ['M', 'Mike'], ['N', 'November'], ['O', 'Oscar'], ['P', 'Papa'],
                ['Q', 'Quebec'], ['R', 'Romeo'], ['S', 'Sierra'], ['T', 'Tango'],
                ['U', 'Uniform'], ['V', 'Victor'], ['W', 'Whiskey'], ['X', 'Xray'],
                ['Y', 'Yankee'], ['Z', 'Zulu']
            ],
            pt_BR: [
                ['A', 'Alfa'], ['B', 'Bravo'], ['C', 'Charlie'], ['D', 'Delta'],
                ['E', 'Echo'], ['F', 'Foxtrot'], ['G', 'Golf'], ['H', 'Hotel'],
                ['I', 'India'], ['J', 'Juliet'], ['K', 'Kilo'], ['L', 'Lima'],
                ['M', 'Mike'], ['N', 'November'], ['O', 'Oscar'], ['P', 'Papa'],
                ['Q', 'Quebec'], ['R', 'Romeo'], ['S', 'Sierra'], ['T', 'Tango'],
                ['U', 'Uniform'], ['V', 'Victor'], ['W', 'Whiskey'], ['X', 'Xray'],
                ['Y', 'Yankee'], ['Z', 'Zulu']
            ]
        };

        const RANDOM_WORDS = {
            sk: [
                'ALENA', 'BORIS', 'CYRIL', 'DAVID', 'ELENA', 'FILIP',
                'KAROL', 'MARIA', 'MILAN', 'PAULA', 'PETER', 'SOFIA',
                'TOMAS', 'URBAN', 'BOCAN', 'LABUT', 'ZABKA', 'CARNI',
                'NOZKI', 'ZMOCI', 'HLAVU', 'VNORI', 'ZABKU', 'CHICI',
                'DOBRE', 'CHUTI', 'DZIVA', 'PLAVA', 'ZOBAK', 'SLOVO',
                'STROM', 'VODA', 'BURKA', 'VIETR', 'BLESK', 'MRAKY'
            ],
            en: [
                'BRAVO', 'DELTA', 'HOTEL', 'INDIA', 'OSCAR', 'ROMEO',
                'TANGO', 'BLACK', 'STORK', 'HEADS', 'BIRDS', 'WATER',
                'CLOUD', 'STORM', 'WINDS', 'RAINS', 'SNOWS', 'TREES',
                'PLANT', 'EARTH', 'RIVER', 'STONE', 'FLASH', 'NIGHT',
                'LIGHT', 'SOUND', 'WORLD', 'PEACE', 'MUSIC', 'POWER'
            ],
            pt_BR: [
                'BRAVO', 'DELTA', 'HOTEL', 'INDIA', 'OSCAR', 'ROMEO',
                'TANGO', 'CISNE', 'PRETO', 'MOLHA', 'AGUAS', 'CHUVA',
                'SOLES', 'VENTO', 'NUVEM', 'PEIXE', 'MARES', 'TERRA',
                'MUNDO', 'PEDRA', 'CLARO', 'NOITE', 'LUZES', 'VOZES',
                'FORTE', 'CAMPO', 'FOGO', 'RAIOS', 'NUVENS', 'VENTOS'
            ]
        };

        const OUTER_FIXED = 'xftzdrseawqmlpnkobjivhucgy';
        const INNER_ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

        // Translations
        let currentLang = localStorage.getItem('agentGameLang') || 'sk';

        const translations = {
            sk: {
                title: "Hra na agenta",
                subtitle: "Gener√°tor protokolov pre skautsk√© dru≈æstv√°",
                tabInstructions: "In≈°trukcie",
                tabStation: "Protokol stanice",
                tabControl: "Protokol riadiacej stanice",
                subtabProtocol: "Protokol Stanice",
                subtabCircles: "Vn√∫torn√© Kot√∫ƒçe",

                // Instructions
                gameTitle: "Hra na agenta",
                gameIntro: "Hra na agenta je hr√° pre 1-2 ƒçlenn√© dru≈æstv√° det√≠ (skautov), tieto dru≈æstva s√∫ nazvan√© STANICE, alebo \"agenti\" (volacie znaky: JOTA1, JOTA2...). STANICE prij√≠maj√∫ povely od RIADIACEJ STANICE (volac√≠ znak JOTA), a na z√°klade jej povelov jej nasp√§≈• komunikuj√∫ svoje zistenia. Na konci hry ka≈æd√° STANICA odovzd√° RIADIACEJ STANICI PROTOKOL s v√Ωsledkami svojich zisten√≠. RIADIACA STANICA vyhodnoti protokoly v≈°etk√Ωch stan√≠c a ozn√°mi v√Ωsledok hry. Jednotliv√© stanice \"agenti\" tak maj√∫ spolu zlo≈æi≈• \"k√≥dovanu spr√°vu\", ktor√° zachr√°ni svet a jej znenie sa dozvedia na konci hry.",
                goalTitle: "Cieƒæ hry",
                goalText1: "Cieƒæom celej hry je precviƒçi≈• u det√≠/skautov slovensk√∫ (pr√≠padne medzin√°rodn√∫) hl√°skovaciu abecedu pou≈æ√≠van√∫ v r√°dioamat√©rskom svete a nauƒçi≈• ich komunik√°cii podƒæa v≈°eobecnej sch√©my pre fonick√© r√°dioamat√©rske spojenia.",
                goalText2: "Jednotliv√© stanice \"agenti\" tak maj√∫ spolu zlo≈æi≈• \"k√≥dovan√∫ spr√°vu\", ktor√° zachr√°ni svet a jej znenie sa dozvedia na konci hry.",
                gameflowTitle: "Priebeh hry",
                step1: "1. Pr√≠prava",
                step1Text: "Na zaƒçiatku hry skauti vytvoria 1-2 ƒçlenn√© dru≈æstv√°. Ka≈æd√© dru≈æstvo dostane PMR446 vysielaƒçku. V≈°etky vysielaƒçky s√∫ nastaven√© na rovnak√Ω kan√°l. RIADIACA STANICE (volac√≠ znak JOTA) odovzd√° ka≈æd√©mu dru≈æstvu tvrd√∫ papierov√∫ dosku s perom a PROTOKOLOM STANICE a ozn√°mi v≈°etk√Ωm dru≈æstv√°m ≈°ifrovac√≠ kƒæ√∫ƒç - dve p√≠smen√°, pomocou ktor√©ho bud√∫ ƒèalej de≈°ifrova≈• slov√° podƒæa pokynov na protokole.",
                step2: "2. Rozmiestnenie",
                step2Text: "Jednotliv√© dru≈æstv√° sa roz√≠du do priestoru (napr√≠klad na l√∫ke), tak aby sa navz√°jom nepoƒçuli.",
                step3: "3. Kontrola spojenia",
                step3Text: "Riadiaca stanica sprav√≠ kontrolu spojenia s jednotliv√Ωmi stanicami (x je poradov√© ƒç√≠slo stanice) podƒæa nasleduj√∫cej sch√©my:",
                step4: "4. Odovzd√°vanie slov",
                step4Text: "Riadiaca stanica postupne nadv√§zuje spojenia s jednotliv√Ωmi stanicami a odovzd√°va im slov√°, medzi jednotliv√Ωmi slovami poƒçk√° chv√≠ƒæu:",
                step4Text2: "Stanica JOTAx posklad√° na z√°klade hl√°skovacej abecedy z vyhl√°skovan√Ωch p√≠smen slovo 1 a slovo 2 a zap√≠≈°e ho do protokolu. Potom zaƒçne spracov√°va≈• slov√° podƒæa pokynov v protokole - de≈°ifruje slovo 2 podƒæa kƒæ√∫ƒça. Riadiaca stanica pokraƒçuje spojen√≠m s ƒèal≈°ou JOTAx stanicou.",
                step5: "5. Kontrola pripravenosti",
                step5Text: "Riadiaca stanica nech√° v≈°etk√Ωm staniciam ƒças na spracovanie √∫lohy (cca 10 min√∫t od komunik√°cie s poslednou stanicou) a n√°sledne zavol√° v≈°eobecn√∫ v√Ωzvu, na ktor√∫ bud√∫ stanice JOTAx odpoveda≈• statusom o pripravenosti:",
                step5Text2: "Jednotliv√© stanice odpovedaj√∫:",
                step5Text3: "V pr√≠pade, ≈æe niektor√© stanice nebud√∫ e≈°te pripraven√©, riadiaca stanica im nech√° ƒças a nesk√¥r zopakuje v√Ωzvu znova. Keƒè s√∫ v≈°etky JOTAx stanice pripraven√©, zaƒçne f√°za odovzd√°vania rie≈°en√≠ √∫loh.",
                step6: "6. Odovzd√°vanie rie≈°en√≠",
                step6Text: "Riadiaca stanica postupne vol√° v≈°etky stanice a ≈æiada o vyhl√°skovanie de≈°ifrovan√©ho 1. slova. V√Ωsledok skontroluje podƒæa protokolu riadiacej stanice, v riadku KONTROLA a oznaƒç√≠ zakr√∫≈ækovan√≠m stanicu ak spr√°vne de≈°ifrovala slovo 2.",

                // Radio transmissions
                tx3_1: "JOTAx vol√° ≈•a JOTA",
                tx3_2: "JOTA tu JOTAx Na pr√≠jme",
                tx3_3: "JOTAx JOTA ƒéakujem",
                tx4_1: "JOTAx vol√° ≈•a JOTA",
                tx4_2: "JOTA JOTAx Poƒç√∫vam",
                tx4_3: "JOTAx JOTA Prv√© slovo: Tom√°≈° Xaver Bo≈æena Peter Adam, opakujem: Tom√°≈° Xaver Bo≈æena Peter Adam. M√°≈° zap√≠san√©?",
                tx4_4: "JOTA JOTAx √Åno, m√°m v≈°etko zap√≠san√©, m√¥≈æe≈° pokraƒçova≈• druh√Ωm slovom",
                tx4_5: "JOTAx JOTA Druh√© slovo: Jozef Adam Norbert Karol Oto, opakujem: Jozef Adam Norbert Karol Oto. M√°≈° zap√≠san√©?",
                tx4_6: "JOTA JOTAx V≈°etko prijat√©, m√¥≈æe≈° pokraƒçova≈• na ƒèal≈°iu stanicu.",
                tx5_1: "V√Ωzva pre v≈°etky stanice, tu JOTA: JOTA1 a≈æ JOTAn, ozn√°mte svoju pripravenos≈• odpoveda≈• na √∫lohy!",
                tx5_2: "JOTA JOTAx: Pripraven√° / Potrebujeme e≈°te ƒças",
                tx6_1: "JOTAx vol√° ≈•a JOTA Vyhlaskuj de≈°ifrovan√© 1. slovo",
                tx6_2: "JOTA JOTAx Slovo je: Cyril Adam Rudolf Norbert Ivan",
                tx6_3: "JOTAx JOTA ƒéakujem, Sedem Tri.",

                endingTitle: "Ukonƒçenie hry",
                endingText1: "Po odovzdan√≠ v≈°etk√Ωch dek√≥dovan√Ωch slov stanicami sa v≈°etky dru≈æstv√° z√≠du pri Riadiacej stanici, ktor√° vyhodnot√≠ protokoly jednotliv√Ωch stan√≠c a prejd√∫ si spolu jednotliv√© problemov√© momenty, s ktor√Ωmi stanice mohli ma≈• ≈•a≈ækosti.",
                endingText2: "Nakoniec Riadiaca stanica ozn√°mi v≈°etk√Ωm staniciam spoloƒçne de≈°ifrovan√∫ spr√°vu, ktor√° pomohla zachr√°ni≈• svet a rozd√° dru≈æstv√°m pr√≠padne odmeny.",
                examplesTitle: "Pr√≠klady spr√°v",
                protocolStationTitle: "Protokol stanice",
                protocolStationText: "Protokol stanice je form√°tu A4. V dolnej pravej ƒçasti je fixn√Ω kruh s mal√Ωmi p√≠smenkami anglickej abecedy vo vonkaj≈°√≠ch poliach. S√∫ƒças≈•ou protokolu je aj extern√Ω rotovac√≠ kƒæ√∫ƒçovac√≠ kr√∫≈æok, ktor√Ω sa vlo≈æ√≠ do vn√∫torn√©ho poƒæa fixn√©ho kruhu a nastav√≠ sa podƒæa zdelen√©ho kƒæ√∫ƒça. P√≠smen√° v tomto rotovateƒænom kruhu s√∫ veƒæk√©. Oba kruhy predstavuj√∫ ≈°ifrovanie Albertiho ≈°ifrou.",
                protocolControlTitle: "Protokol riadiacej stanice",
                protocolControlText: "Protokol riadiacej stanice je tabuƒæka s p√°rom slov pre ka≈æd√∫ stanicu a v kontrolnom riadku je de≈°ifrovan√© 1. slovo na z√°klade kƒæ√∫ƒça Albertiho ≈°ifry. Tento protokol pou≈æ√≠va riadiaca stanica na pr√≠pravu hry a kontrolu v√Ωsledkov.",

                // Station Protocol
                stationProtocolGenTitle: "Gener√°tor Protokolu Stanice",
                stationProtocolNote: "N√°zov stanice a ≈°ifrovac√≠ kƒæ√∫ƒç sa vyp√≠≈°u ruƒçne na vytlaƒçen√Ω protokol poƒças hry.",
                copiesLabel: "Poƒçet k√≥pi√≠ protokolu",
                printButton: "üñ®Ô∏è Tlaƒçi≈• protokol",

                // Inner Circles
                innerCirclesGenTitle: "Gener√°tor Vn√∫torn√Ωch Kot√∫ƒçov",
                innerCirclesNote: "Vn√∫torn√© kot√∫ƒçe sa vytlaƒçia, vystrihn√∫ a vlo≈æia do protokolu stanice pre de≈°ifrovanie.",
                wheelSizeLabel: "Veƒækos≈• kot√∫ƒça (px)",
                innerCirclesLabel: "Poƒçet vn√∫torn√Ωch kot√∫ƒçov",
                printCirclesButton: "üñ®Ô∏è Tlaƒçi≈• kot√∫ƒçe",
                wheelsPerPage: "kot√∫ƒçov na stranu",
                pages: "str√°n",
                page: "strana",
                pages2: "strany",

                // Control Protocol
                controlProtocolGenTitle: "Gener√°tor Protokolu Riadiacej Stanice",
                numStationsLabel: "Poƒçet stan√≠c",
                encryptionKeyLabel: "≈†ifrovac√≠ kƒæ√∫ƒç (2 p√≠smen√°)",
                encryptionKeyPlaceholder: "Napr√≠klad: xA",
                encryptionKeyHelp: "Prv√© p√≠smeno z vonkaj≈°ieho kruhu (mal√©), druh√© z vn√∫torn√©ho (veƒæk√©).",
                resultPhraseLabel: "V√Ωsledn√° fr√°za (slov√° oddelen√© medzerou)",
                resultPhrasePlaceholder: "Napr√≠klad: ƒå√ÅRNI BOƒåAN NO≈ΩKI ZMOƒå√ç HLAVU",
                resultPhraseHelp: "Toto s√∫ slov√°, ktor√© stanice de≈°ifruj√∫. Ka≈æd√© slovo presne 5 znakov.",
                controlWordsLabel: "Kontroln√© slov√° pre 2. riadok (voliteƒæn√©)",
                controlWordsPlaceholder: "Napr√≠klad: ALENA BORIS CYRIL (nechajte pr√°zdne pre n√°hodn√© generovanie)",
                controlWordsHelp: "Slov√° sa n√°hodne vygeneruj√∫, ak niƒç nezad√°te. Ka≈æd√© slovo presne 5 znakov.",
                generateButton: "‚ú® Generova≈• protokol",

                // Protocol labels
                station: "STANICA",
                key: "KƒΩ√öƒå",
                word1: "1. SLOVO",
                word2: "2. SLOVO",
                decodeInstruction: "DEK√ìDUJ 1. RIADOK PODƒΩA KƒΩ√öƒåA",
                callCentralInstruction: "ZAVOLAJ CENTR√ÅLNU STANICU JOTA A ODOVZDAJ DEK√ìDOVAN√â SLOVO.",
                spellInstruction: "SLOVO VYHL√ÅSKUJ POU≈ΩIT√çM HL√ÅSKOVACEJ ABECEDY",
                keyCodeWords: "KƒΩ√öƒå - K√≥dov√© slov√°",
                control: "KONTROLA",

                // Alerts
                alertInvalidKey: "Zadajte platn√Ω 2-znakov√Ω kƒæ√∫ƒç!",
                alertNoPhrase: "Zadajte v√Ωsledn√∫ fr√°zu!",
                alertWordTooLong: "Slovo '{word}' m√° {length} znakov. Slovo mus√≠ ma≈• presne 5 znakov."
            },
            en: {
                title: "Agent Game",
                subtitle: "Protocol Generator for Scout Teams",
                tabInstructions: "Instructions",
                tabStation: "Station Protocol",
                tabControl: "Control Station Protocol",
                subtabProtocol: "Station Protocol",
                subtabCircles: "Inner Wheels",

                // Instructions
                gameTitle: "Agent Game",
                gameIntro: "Agent Game is a game for 1-2 member teams of children (scouts), these teams are called STATIONS, or \"agents\" (callsigns: JOTA1, JOTA2...). STATIONS receive commands from the CONTROL STATION (callsign JOTA), and based on its commands they communicate their findings back. At the end of the game, each STATION submits a PROTOCOL with the results of their findings to the CONTROL STATION. The CONTROL STATION evaluates the protocols of all stations and announces the game result. Individual \"agent\" stations must together compose a \"coded message\" that will save the world and they will learn its content at the end of the game.",
                goalTitle: "Game Objective",
                goalText1: "The objective of the entire game is to practice the international phonetic alphabet used in the amateur radio world among children/scouts and to teach them communication according to the general scheme for phonic amateur radio connections.",
                goalText2: "Individual \"agent\" stations must together compose a \"coded message\" that will save the world and they will learn its content at the end of the game.",
                gameflowTitle: "Game Flow",
                step1: "1. Preparation",
                step1Text: "At the beginning of the game, scouts form 1-2 member teams. Each team gets a PMR446 radio. All radios are set to the same channel. The CONTROL STATION (callsign JOTA) gives each team a hard paperboard with a pen and STATION PROTOCOL and announces to all teams the encryption key - two letters, which they will use to decrypt words according to the instructions on the protocol.",
                step2: "2. Deployment",
                step2Text: "Individual teams spread out in the area (for example on a meadow), so that they cannot hear each other.",
                step3: "3. Connection Check",
                step3Text: "The control station performs a connection check with individual stations (x is the station sequence number) according to the following scheme:",
                step4: "4. Word Transmission",
                step4Text: "The control station successively establishes connections with individual stations and transmits words to them, waiting a moment between individual words:",
                step4Text2: "Station JOTAx assembles word 1 and word 2 from the spelled letters based on the phonetic alphabet and writes it in the protocol. Then it begins processing the words according to the instructions in the protocol - decrypts word 2 according to the key. The control station continues with the connection to the next JOTAx station.",
                step5: "5. Readiness Check",
                step5Text: "The control station gives all stations time to process the task (about 10 minutes from communication with the last station) and then calls a general call, to which JOTAx stations will respond with readiness status:",
                step5Text2: "Individual stations respond:",
                step5Text3: "If some stations are not yet ready, the control station gives them time and later repeats the call again. When all JOTAx stations are ready, the phase of submitting solutions begins.",
                step6: "6. Solution Submission",
                step6Text: "The control station successively calls all stations and asks for spelling of the decrypted 1st word. It checks the result according to the control station protocol, in the CONTROL row and marks the station by circling if it correctly decrypted word 2.",

                // Radio transmissions
                tx3_1: "JOTAx JOTA",
                tx3_2: "JOTA here's JOTAx Listening",
                tx3_3: "JOTAx JOTA Thank you",
                tx4_1: "JOTAx JOTA",
                tx4_2: "JOTA JOTAx Listening",
                tx4_3: "JOTAx JOTA First word: Tango Xray Bravo Papa Alfa, repeat: Tango Xray Bravo Papa Alfa. Copy?",
                tx4_4: "JOTA JOTAx Yes, all copied, you can proceed with second word",
                tx4_5: "JOTAx JOTA Second word: Juliet Alfa November Kilo Oscar, repeat: Juliet Alfa November Kilo Oscar. Copy?",
                tx4_6: "JOTA JOTAx All received, you can proceed to next station.",
                tx5_1: "CQ CQ this is JOTA: JOTA1 to JOTAn, report your readiness to respond to tasks!",
                tx5_2: "JOTA JOTAx: Ready / We need more time",
                tx6_1: "JOTAx JOTA Spell decrypted 1st word",
                tx6_2: "JOTA JOTAx Word is: Charlie Alfa Romeo November India",
                tx6_3: "JOTAx JOTA Thank you, Seven Three.",

                endingTitle: "Game Ending",
                endingText1: "After all decoded words have been submitted by the stations, all teams gather at the Control Station, which evaluates the protocols of individual stations and they go through the problematic moments together that the stations may have had difficulties with.",
                endingText2: "Finally, the Control Station announces to all stations the jointly decrypted message that helped save the world and distributes possible rewards to the teams.",
                examplesTitle: "Message Examples",
                protocolStationTitle: "Station Protocol",
                protocolStationText: "The station protocol is A4 format. In the lower right part there is a fixed circle with small letters of the English alphabet in the outer fields. Part of the protocol is also an external rotating encryption wheel, which is inserted into the inner field of the fixed circle and set according to the shared key. The letters in this rotatable circle are capital. Both circles represent Alberti cipher encryption.",
                protocolControlTitle: "Control Station Protocol",
                protocolControlText: "The control station protocol is a table with a pair of words for each station and in the control row is the decrypted 1st word based on the Alberti cipher key. This protocol is used by the control station to prepare the game and check results.",

                // Station Protocol
                stationProtocolGenTitle: "Station Protocol Generator",
                stationProtocolNote: "Station name and encryption key will be written manually on the printed protocol during the game.",
                copiesLabel: "Number of protocol copies",
                printButton: "üñ®Ô∏è Print protocol",

                // Inner Circles
                innerCirclesGenTitle: "Inner Wheels Generator",
                innerCirclesNote: "Inner wheels are printed, cut out and inserted into the station protocol for decryption.",
                wheelSizeLabel: "Wheel size (px)",
                innerCirclesLabel: "Number of inner wheels",
                printCirclesButton: "üñ®Ô∏è Print wheels",
                wheelsPerPage: "wheels per page",
                pages: "pages",
                page: "page",
                pages2: "pages",

                // Control Protocol
                controlProtocolGenTitle: "Control Station Protocol Generator",
                numStationsLabel: "Number of stations",
                encryptionKeyLabel: "Encryption key (2 letters)",
                encryptionKeyPlaceholder: "For example: xA",
                encryptionKeyHelp: "First letter from outer wheel (lowercase), second from inner (uppercase).",
                resultPhraseLabel: "Result phrase (words separated by space)",
                resultPhrasePlaceholder: "For example: BLACK STORK WATER HEADS",
                resultPhraseHelp: "These are the words that stations will decrypt. Exactly 5 chars per word.",
                controlWordsLabel: "Control words for 2nd row (optional)",
                controlWordsPlaceholder: "For example: BRAVO DELTA HOTEL (leave empty for random generation)",
                controlWordsHelp: "Words will be randomly generated if you don't enter anything. Exactly 5 chars per word.",
                generateButton: "‚ú® Generate protocol",

                // Protocol labels
                station: "STATION",
                key: "KEY",
                word1: "1st WORD",
                word2: "2nd WORD",
                decodeInstruction: "DECODE 1ST ROW ACCORDING TO KEY",
                callCentralInstruction: "CALL CENTRAL STATION JOTA AND SUBMIT DECODED WORD.",
                spellInstruction: "SPELL THE WORD USING THE PHONETIC ALPHABET",
                keyCodeWords: "KEY - Code Words",
                control: "CONTROL",

                // Alerts
                alertInvalidKey: "Enter a valid 2-character key!",
                alertNoPhrase: "Enter a result phrase!",
                alertWordTooLong: "Word '{word}' has {length} characters. Word must have exactly 5 characters."
            },
            pt_BR: {
                title: "Jogo do Agente",
                subtitle: "Gerador de Protocolos para Equipes Escoteiras",
                tabInstructions: "Instru√ß√µes",
                tabStation: "Protocolo da Esta√ß√£o",
                tabControl: "Protocolo da Esta√ß√£o de Controle",
                subtabProtocol: "Protocolo da Esta√ß√£o",
                subtabCircles: "Rodas Internas",

                // Instructions
                gameTitle: "Jogo do Agente",
                gameIntro: "O Jogo do Agente √© um jogo para equipes de 1-2 membros de crian√ßas (escoteiros), essas equipes s√£o chamadas de ESTA√á√ïES, ou \"agentes\" (indicativos: JOTA1, JOTA2...). As ESTA√á√ïES recebem comandos da ESTA√á√ÉO DE CONTROLE (indicativo JOTA), e com base em seus comandos comunicam suas descobertas de volta. No final do jogo, cada ESTA√á√ÉO submete um PROTOCOLO com os resultados de suas descobertas √† ESTA√á√ÉO DE CONTROLE. A ESTA√á√ÉO DE CONTROLE avalia os protocolos de todas as esta√ß√µes e anuncia o resultado do jogo. As esta√ß√µes \"agentes\" individuais devem compor juntas uma \"mensagem codificada\" que salvar√° o mundo e aprender√£o seu conte√∫do no final do jogo.",
                goalTitle: "Objetivo do Jogo",
                goalText1: "O objetivo de todo o jogo √© praticar o alfabeto fon√©tico internacional usado no mundo do r√°dio amador entre crian√ßas/escoteiros e ensin√°-los a comunica√ß√£o de acordo com o esquema geral para conex√µes fon√©ticas de r√°dio amador.",
                goalText2: "As esta√ß√µes \"agentes\" individuais devem compor juntas uma \"mensagem codificada\" que salvar√° o mundo e aprender√£o seu conte√∫do no final do jogo.",
                gameflowTitle: "Fluxo do Jogo",
                step1: "1. Prepara√ß√£o",
                step1Text: "No in√≠cio do jogo, os escoteiros formam equipes de 1-2 membros. Cada equipe recebe um r√°dio PMR446. Todos os r√°dios est√£o configurados no mesmo canal. A ESTA√á√ÉO DE CONTROLE (indicativo JOTA) d√° a cada equipe um papel√£o duro com uma caneta e PROTOCOLO DA ESTA√á√ÉO e anuncia para todas as equipes a chave de criptografia - duas letras, que elas usar√£o para descriptografar palavras de acordo com as instru√ß√µes no protocolo.",
                step2: "2. Implanta√ß√£o",
                step2Text: "As equipes individuais se espalham pela √°rea (por exemplo, em um prado), para que n√£o possam ouvir umas √†s outras.",
                step3: "3. Verifica√ß√£o de Conex√£o",
                step3Text: "A esta√ß√£o de controle realiza uma verifica√ß√£o de conex√£o com esta√ß√µes individuais (x √© o n√∫mero de sequ√™ncia da esta√ß√£o) de acordo com o seguinte esquema:",
                step4: "4. Transmiss√£o de Palavras",
                step4Text: "A esta√ß√£o de controle estabelece sucessivamente conex√µes com esta√ß√µes individuais e transmite palavras para elas, esperando um momento entre palavras individuais:",
                step4Text2: "A esta√ß√£o JOTAx monta a palavra 1 e a palavra 2 das letras soletradas com base no alfabeto fon√©tico e a escreve no protocolo. Ent√£o come√ßa a processar as palavras de acordo com as instru√ß√µes no protocolo - descriptografa a palavra 2 de acordo com a chave. A esta√ß√£o de controle continua com a conex√£o com a pr√≥xima esta√ß√£o JOTAx.",
                step5: "5. Verifica√ß√£o de Prontid√£o",
                step5Text: "A esta√ß√£o de controle d√° a todas as esta√ß√µes tempo para processar a tarefa (cerca de 10 minutos da comunica√ß√£o com a √∫ltima esta√ß√£o) e ent√£o faz uma chamada geral, √† qual as esta√ß√µes JOTAx responder√£o com status de prontid√£o:",
                step5Text2: "As esta√ß√µes individuais respondem:",
                step5Text3: "Se algumas esta√ß√µes ainda n√£o estiverem prontas, a esta√ß√£o de controle d√°-lhes tempo e depois repete a chamada novamente. Quando todas as esta√ß√µes JOTAx estiverem prontas, come√ßa a fase de envio de solu√ß√µes.",
                step6: "6. Envio de Solu√ß√£o",
                step6Text: "A esta√ß√£o de controle chama sucessivamente todas as esta√ß√µes e solicita a soletra√ß√£o da 1¬™ palavra descriptografada. Ela verifica o resultado de acordo com o protocolo da esta√ß√£o de controle, na linha de CONTROLE e marca a esta√ß√£o circulando se descriptografou corretamente a palavra 2.",

                // Radio transmissions
                tx3_1: "JOTAx JOTA",
                tx3_2: "JOTA aqui JOTAx Na escuta",
                tx3_3: "JOTAx JOTA Obrigado",
                tx4_1: "JOTAx JOTA",
                tx4_2: "JOTA JOTAx Escutando",
                tx4_3: "JOTAx JOTA Primeira palavra: Tango Xray Bravo Papa Alfa, repito: Tango Xray Bravo Papa Alfa. Recebeu?",
                tx4_4: "JOTA JOTAx Sim, tudo copiado, pode prosseguir com segunda palavra",
                tx4_5: "JOTAx JOTA Segunda palavra: Juliet Alfa November Kilo Oscar, repito: Juliet Alfa November Kilo Oscar. Recebeu?",
                tx4_6: "JOTA JOTAx Tudo recebido, pode prosseguir para pr√≥xima esta√ß√£o.",
                tx5_1: "CQ CQ, aqui JOTA: JOTA1 at√© JOTAn, reportem sua prontid√£o para responder √†s tarefas!",
                tx5_2: "JOTA JOTAx: Pronto / Precisamos mais tempo",
                tx6_1: "JOTAx JOTA Soletre palavra descriptografada 1",
                tx6_2: "JOTA JOTAx Palavra √©: Charlie Alfa Romeo November India",
                tx6_3: "JOTAx JOTA Obrigado, Sete Tr√™s.",

                endingTitle: "Final do Jogo",
                endingText1: "Depois que todas as palavras decodificadas foram enviadas pelas esta√ß√µes, todas as equipes se re√∫nem na Esta√ß√£o de Controle, que avalia os protocolos das esta√ß√µes individuais e elas passam pelos momentos problem√°ticos juntas que as esta√ß√µes podem ter tido dificuldades.",
                endingText2: "Finalmente, a Esta√ß√£o de Controle anuncia a todas as esta√ß√µes a mensagem conjuntamente descriptografada que ajudou a salvar o mundo e distribui poss√≠veis recompensas √†s equipes.",
                examplesTitle: "Exemplos de Mensagens",
                protocolStationTitle: "Protocolo da Esta√ß√£o",
                protocolStationText: "O protocolo da esta√ß√£o √© formato A4. Na parte inferior direita h√° um c√≠rculo fixo com letras min√∫sculas do alfabeto ingl√™s nos campos externos. Parte do protocolo √© tamb√©m uma roda de criptografia rotativa externa, que √© inserida no campo interno do c√≠rculo fixo e configurada de acordo com a chave compartilhada. As letras neste c√≠rculo girat√≥rio s√£o mai√∫sculas. Ambos os c√≠rculos representam criptografia de cifra de Alberti.",
                protocolControlTitle: "Protocolo da Esta√ß√£o de Controle",
                protocolControlText: "O protocolo da esta√ß√£o de controle √© uma tabela com um par de palavras para cada esta√ß√£o e na linha de controle est√° a 1¬™ palavra descriptografada com base na chave de cifra de Alberti. Este protocolo √© usado pela esta√ß√£o de controle para preparar o jogo e verificar resultados.",

                // Station Protocol
                stationProtocolGenTitle: "Gerador de Protocolo da Esta√ß√£o",
                stationProtocolNote: "O nome da esta√ß√£o e a chave de criptografia ser√£o escritos manualmente no protocolo impresso durante o jogo.",
                copiesLabel: "N√∫mero de c√≥pias do protocolo",
                printButton: "üñ®Ô∏è Imprimir protocolo",

                // Inner Circles
                innerCirclesGenTitle: "Gerador de Rodas Internas",
                innerCirclesNote: "As rodas internas s√£o impressas, recortadas e inseridas no protocolo da esta√ß√£o para descriptografia.",
                wheelSizeLabel: "Tamanho da roda (px)",
                innerCirclesLabel: "N√∫mero de rodas internas",
                printCirclesButton: "üñ®Ô∏è Imprimir rodas",
                wheelsPerPage: "rodas por p√°gina",
                pages: "p√°ginas",
                page: "p√°gina",
                pages2: "p√°ginas",

                // Control Protocol
                controlProtocolGenTitle: "Gerador de Protocolo da Esta√ß√£o de Controle",
                numStationsLabel: "N√∫mero de esta√ß√µes",
                encryptionKeyLabel: "Chave de criptografia (2 letras)",
                encryptionKeyPlaceholder: "Por exemplo: xA",
                encryptionKeyHelp: "Primeira letra da roda externa (min√∫scula), segunda da interna (mai√∫scula).",
                resultPhraseLabel: "Frase resultado (palavras separadas por espa√ßo)",
                resultPhrasePlaceholder: "Por exemplo: CISNE PRETO MOLHA",
                resultPhraseHelp: "Estas s√£o as palavras que as esta√ß√µes v√£o descriptografar. Exatamente 5 caracteres por palavra.",
                controlWordsLabel: "Palavras de controle para 2¬™ linha (opcional)",
                controlWordsPlaceholder: "Por exemplo: BRAVO DELTA HOTEL (deixe vazio para gera√ß√£o aleat√≥ria)",
                controlWordsHelp: "As palavras ser√£o geradas aleatoriamente se voc√™ n√£o inserir nada. Exatamente 5 caracteres por palavra.",
                generateButton: "‚ú® Gerar protocolo",

                // Protocol labels
                station: "ESTA√á√ÉO",
                key: "CHAVE",
                word1: "1¬™ PALAVRA",
                word2: "2¬™ PALAVRA",
                decodeInstruction: "DECODIFIQUE A 1¬™ LINHA DE ACORDO COM A CHAVE",
                callCentralInstruction: "CHAME A ESTA√á√ÉO CENTRAL JOTA E ENVIE A PALAVRA DECODIFICADA.",
                spellInstruction: "SOLETRE A PALAVRA USANDO O ALFABETO FON√âTICO",
                keyCodeWords: "CHAVE - Palavras C√≥digo",
                control: "CONTROLE",

                // Alerts
                alertInvalidKey: "Digite uma chave v√°lida de 2 caracteres!",
                alertNoPhrase: "Digite uma frase resultado!",
                alertWordTooLong: "Palavra '{word}' tem {length} caracteres. Palavra deve ter exatamente 5 caracteres."
            }
        };

        // Language switching
        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('agentGameLang', lang);

            // Update language buttons
            document.querySelectorAll('.language-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang === 'pt_BR' ? 'pt' : lang}`).classList.add('active');

            // Update document language
            document.documentElement.lang = lang === 'pt_BR' ? 'pt-BR' : lang;

            // Update all texts
            updateTexts();

            // Regenerate protocols with new language
            generateStationProtocols();
            if (document.getElementById('control-protocol-output').innerHTML) {
                generateControlProtocol();
            }
            if (document.getElementById('subtab-circles').classList.contains('active')) {
                generateInnerWheels();
            }
        }

        function updateTexts() {
            const t = translations[currentLang];

            // Update document title
            document.title = t.title + ' - ' + t.subtitle;

            // Update all elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) {
                    el.textContent = t[key];
                }
            });

            // Update placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (t[key]) {
                    el.placeholder = t[key];
                }
            });
        }

        // Tab switching
        function switchTab(tabName, buttonElement) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');
            buttonElement.classList.add('active');

            // Generate station protocols when switching to that tab
            if (tabName === 'station') {
                generateStationProtocols();
            }
        }

        // Alberti cipher encryption
        function encryptAlberti(plaintext, outerKey, innerKey) {
            const outerPosition = OUTER_FIXED.indexOf(outerKey.toLowerCase());
            const innerPosition = INNER_ALPHABET.indexOf(innerKey.toUpperCase());

            if (outerPosition === -1 || innerPosition === -1) return 'INVALID';

            const offset = outerPosition - innerPosition;
            let result = '';

            for (const char of plaintext.toUpperCase()) {
                if (INNER_ALPHABET.includes(char)) {
                    const charPos = INNER_ALPHABET.indexOf(char);
                    const outerPos = (charPos + offset + 26) % 26;
                    result += OUTER_FIXED[outerPos].toUpperCase();
                } else {
                    result += char;
                }
            }

            return result;
        }

        // Generate random word
        function generateRandomWord() {
            const words = RANDOM_WORDS[currentLang] || RANDOM_WORDS.sk;
            return words[Math.floor(Math.random() * words.length)];
        }

        // Create outer cipher wheel SVG
        function createOuterCipherWheel() {
            const radius = 250;
            const innerRadius = 210;
            const centerX = 300;
            const centerY = 300;
            const textRadius = (radius + innerRadius) / 2;

            let svg = '<svg viewBox="0 0 600 600" style="width: 100%; max-width: 400px; height: auto;">';
            svg += `<circle cx="${centerX}" cy="${centerY}" r="${radius}" fill="none" stroke="black" stroke-width="4"/>`;

            // Draw segments and letters
            for (let i = 0; i < 26; i++) {
                const startAngle = (i * 360 / 26 - 90) * Math.PI / 180;
                const endAngle = ((i + 1) * 360 / 26 - 90) * Math.PI / 180;
                const midAngle = ((i + 0.5) * 360 / 26 - 90) * Math.PI / 180;
                const rotationAngle = (i + 0.5) * 360 / 26;

                const x1 = centerX + radius * Math.cos(startAngle);
                const y1 = centerY + radius * Math.sin(startAngle);
                const x2 = centerX + radius * Math.cos(endAngle);
                const y2 = centerY + radius * Math.sin(endAngle);
                const ix1 = centerX + innerRadius * Math.cos(startAngle);
                const iy1 = centerY + innerRadius * Math.sin(startAngle);
                const ix2 = centerX + innerRadius * Math.cos(endAngle);
                const iy2 = centerY + innerRadius * Math.sin(endAngle);

                const pathData = `M ${x1} ${y1} A ${radius} ${radius} 0 0 1 ${x2} ${y2} L ${ix2} ${iy2} A ${innerRadius} ${innerRadius} 0 0 0 ${ix1} ${iy1} Z`;

                svg += `<path d="${pathData}" fill="white" stroke="black" stroke-width="2"/>`;

                const textX = centerX + textRadius * Math.cos(midAngle);
                const textY = centerY + textRadius * Math.sin(midAngle);

                svg += `<text x="${textX}" y="${textY}" text-anchor="middle" dominant-baseline="central" font-size="22" font-weight="bold" transform="rotate(${rotationAngle}, ${textX}, ${textY})">${OUTER_FIXED[i]}</text>`;
            }

            svg += `<circle cx="${centerX}" cy="${centerY}" r="${innerRadius}" fill="white" stroke="black" stroke-width="4"/>`;
            svg += `<circle cx="${centerX}" cy="${centerY}" r="6" fill="black"/>`;
            svg += '</svg>';

            return svg;
        }

        // Generate phonetic alphabet HTML
        function generatePhoneticAlphabetHTML() {
            const alphabet = PHONETIC_ALPHABETS[currentLang] || PHONETIC_ALPHABETS.sk;
            let html = '<div class="phonetic-grid">';
            alphabet.forEach(([letter, word]) => {
                html += `<div class="phonetic-item"><strong>${letter}</strong><span>${word}</span></div>`;
            });
            html += '</div>';
            return html;
        }

        // Station Protocol Generation
        function generateStationProtocols() {
            const copies = parseInt(document.getElementById('protocolCopies').value) || 1;
            const container = document.getElementById('station-protocols');
            const t = translations[currentLang];

            let html = '';
            for (let i = 0; i < copies; i++) {
                const pageBreak = i < copies - 1 ? 'page-break' : '';
                html += `
                    <div class="card ${pageBreak}">
                        <div class="protocol-header">
                            <div class="protocol-header-box">
                                <label>${t.station}</label>
                                <div class="protocol-header-line"></div>
                            </div>
                            <div class="protocol-header-box">
                                <label>${t.key}</label>
                                <div class="protocol-header-line"></div>
                            </div>
                        </div>

                        <div class="protocol-box">
                            <div style="background: white; border: 2px solid black; display: inline-block; padding: 0.25rem 0.5rem; font-weight: bold; font-size: 0.85rem; margin-bottom: 0.5rem;">${t.word1}</div>
                            <div class="protocol-fields">
                                ${Array(5).fill('<div class="protocol-field"></div>').join('')}
                            </div>
                        </div>

                        <div class="protocol-box">
                            <div style="background: white; border: 2px solid black; display: inline-block; padding: 0.25rem 0.5rem; font-weight: bold; font-size: 0.85rem; margin-bottom: 0.5rem;">${t.word2}</div>
                            <div class="protocol-fields">
                                ${Array(5).fill('<div class="protocol-field"></div>').join('')}
                            </div>
                        </div>

                        <div class="protocol-box">
                            <div style="background: white; border: 2px solid black; display: inline-block; padding: 0.25rem 0.5rem; font-weight: bold; font-size: 0.85rem; margin-bottom: 0.5rem;">${t.decodeInstruction}</div>
                            <div class="protocol-fields">
                                ${Array(5).fill('<div class="protocol-field"></div>').join('')}
                            </div>
                        </div>

                        <div class="info-box">
                            <p style="font-weight: bold; margin-bottom: 0.5rem;">${t.callCentralInstruction}</p>
                            <p>${t.spellInstruction}</p>
                        </div>

                        <div class="grid-2">
                            <div style="border: 1px solid black; padding: 1rem; border-radius: 4px;">
                                <div style="font-weight: bold; text-align: center; margin-bottom: 1rem;">${t.keyCodeWords}</div>
                                ${generatePhoneticAlphabetHTML()}
                            </div>
                            <div class="cipher-wheel-container">
                                ${createOuterCipherWheel()}
                            </div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        // Control Protocol Generation
        function generateControlProtocol() {
            const numStations = parseInt(document.getElementById('numStations').value) || 5;
            const key = document.getElementById('controlKey').value;
            const resultPhrase = document.getElementById('resultPhrase').value.trim().toUpperCase();
            const controlWords = document.getElementById('controlWords').value.trim().toUpperCase();
            const t = translations[currentLang];

            if (!key || key.length !== 2) {
                alert(t.alertInvalidKey);
                return;
            }

            if (!resultPhrase) {
                alert(t.alertNoPhrase);
                return;
            }

            const resultWords = resultPhrase.split(/\s+/).filter(w => w.length > 0);

            // Validate that all words are exactly 5 characters
            for (const word of resultWords) {
                if (word.length !== 5) {
                    alert(t.alertWordTooLong.replace('{word}', word).replace('{length}', word.length));
                    return;
                }
            }

            const outerKey = key[0];
            const innerKey = key[1];
            const actualNumStations = Math.min(numStations, resultWords.length);

            const row1Words = resultWords.slice(0, actualNumStations).map(word =>
                encryptAlberti(word, outerKey, innerKey)
            );

            let row2Words;
            if (controlWords) {
                row2Words = controlWords.split(/\s+/).filter(w => w.length > 0);

                // Validate that all control words are exactly 5 characters
                for (const word of row2Words) {
                    if (word.length !== 5) {
                        alert(t.alertWordTooLong.replace('{word}', word).replace('{length}', word.length));
                        return;
                    }
                }

                while (row2Words.length < actualNumStations) {
                    row2Words.push(generateRandomWord());
                }
                row2Words = row2Words.slice(0, actualNumStations);
            } else {
                row2Words = Array.from({ length: actualNumStations }, () => generateRandomWord());
            }

            const stations = Array.from({ length: actualNumStations }, (_, i) => `JOTA${i + 1}`);
            const controlRow = resultWords.slice(0, actualNumStations);

            // Generate HTML
            let html = `
                <div class="card">
                    <style>
                        @media print {
                            @page { size: A4 landscape; margin: 10mm; }
                        }
                    </style>
                    <table class="protocol-table">
                        <thead>
                            <tr>
                                <th>${t.station}</th>
                                ${stations.map(s => `<th>${s}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="font-weight: bold; background: white;">${t.word1}</td>
                                ${row1Words.map(w => `<td class="encrypted">${w}</td>`).join('')}
                            </tr>
                            <tr>
                                <td style="font-weight: bold; background: white;">${t.word2}</td>
                                ${row2Words.map(w => `<td style="font-family: monospace;">${w}</td>`).join('')}
                            </tr>
                            <tr>
                                <td style="font-weight: bold; background: white;">${t.control}</td>
                                ${controlRow.map(w => `<td class="control">${w}</td>`).join('')}
                            </tr>
                        </tbody>
                    </table>

                    <div class="grid-2">
                        <div style="border: 2px solid black; padding: 1rem; border-radius: 4px;">
                            <div style="font-weight: bold; text-align: center; margin-bottom: 1rem;">${t.keyCodeWords}</div>
                            ${generatePhoneticAlphabetHTML()}
                        </div>
                        <div style="border: 2px solid black; padding: 2rem; border-radius: 4px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <div style="font-weight: bold; margin-bottom: 1rem;">${t.key}</div>
                            <div style="font-size: 4rem; font-weight: bold;">${key}</div>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('control-protocol-output').innerHTML = html;
            document.getElementById('printControlBtn').style.display = 'inline-block';
        }

        // Number control functions
        function changeProtocolCopies(delta) {
            const input = document.getElementById('protocolCopies');
            const newValue = Math.max(1, Math.min(50, parseInt(input.value) + delta));
            input.value = newValue;
            generateStationProtocols();
        }

        function updateProtocolCopies() {
            const input = document.getElementById('protocolCopies');
            input.value = Math.max(1, Math.min(50, parseInt(input.value) || 1));
            generateStationProtocols();
        }

        function changeNumStations(delta) {
            const input = document.getElementById('numStations');
            const newValue = Math.max(1, Math.min(20, parseInt(input.value) + delta));
            input.value = newValue;
        }

        function updateNumStations() {
            const input = document.getElementById('numStations');
            input.value = Math.max(1, Math.min(20, parseInt(input.value) || 1));
        }

        // Print function
        function printProtocol() {
            window.print();
        }

        // Subtab switching
        function switchSubtab(subtabName, buttonElement) {
            document.querySelectorAll('.subtab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.subtab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById('subtab-' + subtabName).classList.add('active');
            buttonElement.classList.add('active');

            if (subtabName === 'circles') {
                generateInnerWheels();
            }
        }

        // Create inner cipher wheel SVG
        function createInnerCipherWheel() {
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const radius = 208;
            const centerX = 300;
            const centerY = 300;
            const textRadius = radius * 0.85;

            let svg = '<svg viewBox="0 0 600 600" style="width: 100%; height: auto;">';
            svg += `<circle cx="${centerX}" cy="${centerY}" r="${radius}" fill="white" stroke="black" stroke-width="3"/>`;

            // Draw segments and letters
            for (let i = 0; i < 26; i++) {
                const startAngle = (i * 360 / 26 - 90) * Math.PI / 180;
                const x1 = centerX;
                const y1 = centerY;
                const x2 = centerX + radius * Math.cos(startAngle);
                const y2 = centerY + radius * Math.sin(startAngle);

                svg += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="black" stroke-width="2"/>`;

                const midAngle = ((i + 0.5) * 360 / 26 - 90) * Math.PI / 180;
                const rotationAngle = (i + 0.5) * 360 / 26;
                const textX = centerX + textRadius * Math.cos(midAngle);
                const textY = centerY + textRadius * Math.sin(midAngle);

                svg += `<text x="${textX}" y="${textY}" text-anchor="middle" dominant-baseline="central" font-size="36" font-weight="bold" transform="rotate(${rotationAngle}, ${textX}, ${textY})">${alphabet[i]}</text>`;
            }

            svg += `<circle cx="${centerX}" cy="${centerY}" r="18" fill="white" stroke="black" stroke-width="3"/>`;
            svg += `<circle cx="${centerX}" cy="${centerY}" r="6" fill="black"/>`;
            svg += '</svg>';

            return svg;
        }

        // Calculate circles per page
        function calculateCirclesPerPage(size) {
            // A4 page: 210mm x 297mm = ~794px x 1123px at 96 DPI
            // Account for print margins (6mm = ~23px)
            const pageWidth = 750;  // ~200mm usable width
            const pageHeight = 1070; // ~285mm usable height
            const cols = Math.floor(pageWidth / size);
            const rows = Math.floor(pageHeight / size);
            return Math.max(1, cols * rows);
        }

        // Generate inner wheels
        function generateInnerWheels() {
            const wheelSize = parseInt(document.getElementById('wheelSize').value) || 350;
            const circleCount = parseInt(document.getElementById('circleCount').value) || 6;
            const circlesPerPage = calculateCirclesPerPage(wheelSize);
            const totalPages = Math.ceil(circleCount / circlesPerPage);
            const t = translations[currentLang];

            // Update info texts
            document.getElementById('wheelsPerPage').textContent = `${circlesPerPage} ${t.wheelsPerPage}`;
            let pagesText = totalPages === 1 ? t.page : (totalPages < 5 && currentLang === 'sk' ? t.pages2 : t.pages);
            document.getElementById('totalPages').textContent = `${totalPages} ${pagesText}`;

            const container = document.getElementById('inner-wheels');
            const cols = Math.max(1, Math.floor(750 / wheelSize));
            const overlap = 50; // Overlap amount in pixels

            let html = '';
            for (let pageIndex = 0; pageIndex < totalPages; pageIndex++) {
                const circlesOnPage = Math.min(circlesPerPage, circleCount - pageIndex * circlesPerPage);
                const pageBreak = pageIndex < totalPages - 1 ? 'page-break' : '';

                html += `<div class="card ${pageBreak}" style="padding: 0; margin: 0;">`;
                html += `<div style="display: grid; grid-template-columns: repeat(${cols}, ${wheelSize}px); gap: 0; justify-content: center; align-items: start;">`;

                for (let i = 0; i < circlesOnPage; i++) {
                    const row = Math.floor(i / cols);
                    const col = i % cols;
                    const marginLeft = col > 0 ? -overlap : 0;
                    const marginTop = row > 0 ? -overlap : 0;

                    html += `<div style="width: ${wheelSize}px; height: ${wheelSize}px; line-height: 0; margin-left: ${marginLeft}px; margin-top: ${marginTop}px;">${createInnerCipherWheel()}</div>`;
                }

                html += '</div></div>';
            }

            container.innerHTML = html;
        }

        // Wheel size controls
        function changeWheelSize(delta) {
            const input = document.getElementById('wheelSize');
            const newValue = Math.max(100, Math.min(400, parseInt(input.value) + delta));
            input.value = newValue;
            generateInnerWheels();
        }

        function updateWheelSize() {
            const input = document.getElementById('wheelSize');
            input.value = Math.max(100, Math.min(400, parseInt(input.value) || 350));
            generateInnerWheels();
        }

        // Circle count controls
        function changeCircleCount(delta) {
            const input = document.getElementById('circleCount');
            const newValue = Math.max(1, Math.min(100, parseInt(input.value) + delta));
            input.value = newValue;
            generateInnerWheels();
        }

        function updateCircleCount() {
            const input = document.getElementById('circleCount');
            input.value = Math.max(1, Math.min(100, parseInt(input.value) || 6));
            generateInnerWheels();
        }

        // Print circles
        function printCircles() {
            window.print();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize language
            updateTexts();
            generateStationProtocols();
            generateInnerWheels();

            // Update language selector buttons
            document.querySelectorAll('.language-selector button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${currentLang === 'pt_BR' ? 'pt' : currentLang}`).classList.add('active');
            document.documentElement.lang = currentLang === 'pt_BR' ? 'pt-BR' : currentLang;

            // Auto-uppercase inputs
            document.getElementById('resultPhrase').addEventListener('input', (e) => {
                e.target.value = e.target.value.toUpperCase();
            });
            document.getElementById('controlWords').addEventListener('input', (e) => {
                e.target.value = e.target.value.toUpperCase();
            });
        });
    </script>
</body>
</html>
